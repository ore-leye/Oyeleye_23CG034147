<!DOCTYPE html>
<html>
<head><title>Emotion Detector</title></head>
<body>
  <h1>Take Photo â†’ Get Emotion</h1>
  <input type="text" id="name" placeholder="Your Name"><br><br>
  <video id="video" width="320" height="240" style="display:none;"></video><br>
  <button onclick="startCam()">Start Camera</button>
  <button onclick="snap()">Capture</button>
  <button onclick="predict()">Predict</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <div id="result"></div>

  <script>
    function startCam() {
      navigator.mediaDevices.getUserMedia({video: true}).then(s => {
        document.getElementById('video').srcObject = s;
        document.getElementById('video').style.display = 'block';
      });
    }
    function snap() {
      const v = document.getElementById('video');
      const c = document.getElementById('canvas');
      c.width = v.videoWidth; c.height = v.videoHeight;
      c.getContext('2d').drawImage(v, 0, 0);
    }
    async function predict() {
      const name = document.getElementById('name').value || "User";
      const dataURL = document.getElementById('canvas').toDataURL('image/jpeg');
      const base64 = dataURL.split(',')[1];

      const form = new FormData();
      form.append('name', name);
      form.append('mode', 'live');
      form.append('image', base64);

      const res = await fetch('/predict', {method: 'POST', body: form});
      const json = await res.json();
      const out = document.getElementById('result');
      if (json.error) out.innerHTML = `<p style="color:red">${json.error}</p>`;
      else out.innerHTML = `<h2>${json.emotion} (${json.confidence}%)</h2><img src="/uploads/${json.image}" width="200">`;
    }
  </script>
</body>
</html>